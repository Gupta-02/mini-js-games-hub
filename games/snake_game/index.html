<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Snake Game</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for Grid Alignment */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(20, 1fr); /* 20x20 grid */
            grid-template-rows: repeat(20, 1fr);
            border: 4px solid #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            aspect-ratio: 1 / 1; /* Force square aspect ratio */
        }
        .grid-cell {
            /* Ensures cells visually fill the space */
            width: 100%;
            height: 100%;
        }

        /* Snake and Food colors */
        .snake { background-color: #10b981; } /* Green */
        .head { background-color: #059669; } /* Darker Green for Head */
        .food { 
            background-color: #ef4444; /* Red */
            border-radius: 50%; /* Make food a circle */
            transform: scale(0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-lg">
        <h1 class="text-4xl font-extrabold text-center mb-6 text-indigo-400">Classic Snake</h1>
        
        <div id="status" class="text-center mb-4 text-xl font-medium">
            Score: <span id="score-display">0</span> | Speed: <span id="speed-display">150ms</span>
        </div>

        <div id="game-grid" class="w-full max-w-xl bg-gray-800">
            <!-- Grid cells injected by JavaScript -->
        </div>
        
        <p id="message" class="text-center mt-6 text-2xl h-8"></p>
        <button id="restart-button" class="mt-4 w-full py-3 bg-indigo-600 hover:bg-indigo-700 font-bold rounded-lg transition duration-200 hidden">
            Restart Game
        </button>
    </div>

    <script>
        // --- Game Constants and State ---
        const GRID_SIZE = 20;
        const INITIAL_SPEED = 150; // milliseconds per step
        
        let snake = [{ x: 10, y: 10 }]; // Snake starts in the center
        let food = {};
        let dx = 1; // Initial movement: right (positive X)
        let dy = 0;
        let score = 0;
        let gameInterval;
        let gameActive = false;
        let newDirection = { dx: 1, dy: 0 }; // Buffer for key presses

        // --- DOM Elements ---
        const gameGrid = document.getElementById('game-grid');
        const scoreDisplay = document.getElementById('score-display');
        const speedDisplay = document.getElementById('speed-display');
        const message = document.getElementById('message');
        const restartButton = document.getElementById('restart-button');

        // --- Core Functions ---

        function initializeGame() {
            // Reset State
            snake = [{ x: 10, y: 10 }];
            dx = 1;
            dy = 0;
            newDirection = { dx: 1, dy: 0 };
            score = 0;
            gameActive = true;
            
            clearInterval(gameInterval);
            
            // UI Reset
            scoreDisplay.textContent = score;
            message.textContent = 'Use arrow keys to start!';
            restartButton.classList.add('hidden');
            
            drawGrid();
            spawnFood();
            
            // Start the movement loop
            gameInterval = setInterval(moveSnake, INITIAL_SPEED);
        }

        function drawGrid() {
            gameGrid.innerHTML = '';
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    gameGrid.appendChild(cell);
                }
            }
        }

        function drawSnake() {
            // Clear all previous snake/food classes
            document.querySelectorAll('.snake, .head, .food').forEach(cell => {
                cell.classList.remove('snake', 'head', 'food');
            });

            // Draw the snake body
            snake.forEach((segment, index) => {
                const cell = document.querySelector(`[data-x="${segment.x}"][data-y="${segment.y}"]`);
                if (cell) {
                    cell.classList.add('snake');
                    if (index === 0) {
                        cell.classList.add('head'); // Highlight the head
                    }
                }
            });

            // Draw the food
            const foodCell = document.querySelector(`[data-x="${food.x}"][data-y="${food.y}"]`);
            if (foodCell) {
                foodCell.classList.add('food');
            }
        }

        function spawnFood() {
            let newFoodPos;
            do {
                newFoodPos = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
                // Ensure food doesn't spawn on the snake
            } while (snake.some(segment => segment.x === newFoodPos.x && segment.y === newFoodPos.y));

            food = newFoodPos;
        }

        function moveSnake() {
            if (!gameActive) return;

            // Apply buffered direction change
            dx = newDirection.dx;
            dy = newDirection.dy;

            // Calculate new head position
            const head = snake[0];
            const newHead = { 
                x: head.x + dx, 
                y: head.y + dy 
            };

            // Check Game Over Conditions (Wall or Self-Collision)
            if (isGameOver(newHead)) {
                endGame();
                return;
            }

            // Add new head to the front of the snake
            snake.unshift(newHead);

            // Check for Food Collision
            if (newHead.x === food.x && newHead.y === food.y) {
                score++;
                scoreDisplay.textContent = score;
                spawnFood(); // Spawn new food
                // Snake grows automatically because we DON'T pop the tail
                // Increase speed every 5 points
                if (score > 0 && score % 5 === 0) {
                    increaseSpeed();
                }
            } else {
                // Remove the tail if no food was eaten (standard movement)
                snake.pop();
            }

            // Redraw everything
            drawSnake();
        }

        function isGameOver(newHead) {
            // 1. Wall Collision
            if (
                newHead.x < 0 || newHead.x >= GRID_SIZE ||
                newHead.y < 0 || newHead.y >= GRID_SIZE
            ) {
                return true;
            }

            // 2. Self Collision (Check if new head overlaps with any body segment)
            // Start checking from the second segment (index 1)
            for (let i = 1; i < snake.length; i++) {
                if (newHead.x === snake[i].x && newHead.y === snake[i].y) {
                    return true;
                }
            }

            return false;
        }
        
        function increaseSpeed() {
            const currentSpeed = INITIAL_SPEED - (score / 5) * 10;
            const newSpeed = Math.max(50, currentSpeed); // Max speed is 50ms
            
            speedDisplay.textContent = `${newSpeed.toFixed(0)}ms`;
            
            clearInterval(gameInterval);
            gameInterval = setInterval(moveSnake, newSpeed);
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameInterval);
            message.textContent = `Game Over! Final Score: ${score}`;
            message.classList.add('text-red-500');
            restartButton.classList.remove('hidden');
        }

        // --- Input Handling (Keyboard) ---

        document.addEventListener('keydown', (e) => {
            const key = e.key;

            // Prevent reversing direction directly
            const goingHorizontal = dx !== 0;
            const goingVertical = dy !== 0;

            if (key === 'ArrowUp' && !goingVertical) {
                newDirection = { dx: 0, dy: -1 };
            } else if (key === 'ArrowDown' && !goingVertical) {
                newDirection = { dx: 0, dy: 1 };
            } else if (key === 'ArrowLeft' && !goingHorizontal) {
                newDirection = { dx: -1, dy: 0 };
            } else if (key === 'ArrowRight' && !goingHorizontal) {
                newDirection = { dx: 1, dy: 0 };
            }
        });

        // --- Event Listeners and Start ---
        restartButton.addEventListener('click', () => {
            message.classList.remove('text-red-500');
            initializeGame();
        });

        window.onload = initializeGame;
    </script>
</body>
</html>
